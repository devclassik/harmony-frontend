<div class="bg-gray-50 min-h-screen">
  <!-- Navigation Tabs -->
  <div class="bg-white border-b border-gray-200">
    <div class="flex space-x-8 px-6 py-3">
      <button
        [class]="
          activeTab === 'organization-structure'
            ? 'flex items-center space-x-2 px-4 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg border border-green-200'
            : 'flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors'
        "
        (click)="setActiveTab('organization-structure')"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <span>Organization Structure</span>
      </button>
      <button
        [class]="
          activeTab === 'user-management'
            ? 'flex items-center space-x-2 px-4 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg border border-green-200'
            : 'flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors'
        "
        (click)="setActiveTab('user-management')"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"
          ></path>
        </svg>
        <span>User Management</span>
      </button>
      <button
        class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed rounded-lg"
        disabled
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <span>Access Control</span>
      </button>
      <button
        class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed rounded-lg"
        disabled
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L15.586 13H14a1 1 0 01-1-1z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <span>Accommodation</span>
      </button>
      <button
        class="flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed rounded-lg"
        disabled
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z"
            clip-rule="evenodd"
          ></path>
        </svg>
        <span>Letter Template</span>
      </button>
    </div>
  </div>

  <!-- Organization Structure Tab Content -->
  <div
    *ngIf="activeTab === 'organization-structure'"
    class="bg-white min-h-screen"
  >
    <!-- Header Section -->
    <div
      class="flex items-center justify-between px-6 py-4 border-b border-gray-200"
    >
      <h2 class="text-lg font-semibold text-gray-900">
        Showing Organization Structure
      </h2>
      <button
        (click)="openCreateDepartmentModal()"
        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
            clip-rule="evenodd"
          />
        </svg>
        <span>Add Department</span>
      </button>
    </div>

    <!-- Main Content -->
    <div class="px-6 py-6">
      <!-- Organization Structure Display -->
      <div *ngIf="organizations.length > 0" class="space-y-8">
        <!-- Director Level -->
        <div class="flex flex-col items-center space-y-4">
          <!-- Director Title Card -->
          <div class="w-64 bg-[#353535] text-white rounded-lg p-3 text-center">
            <div class="font-semibold text-sm">
              Director Superintendent Admin
            </div>
            <div class="text-xs opacity-90">
              {{ getDirectorDepartmentName() }}
            </div>
          </div>

          <!-- Director Profile Card -->
          <div
            *ngIf="getDirector()"
            class="w-64 bg-white border border-gray-200 rounded-lg p-4 shadow-sm"
          >
            <div class="flex items-center space-x-3">
              <div class="relative w-12 h-12">
                <img
                  *ngIf="
                    hasValidPhotoUrl(getDirector());
                    else directorFallbackIcon
                  "
                  [src]="formatImageUrl(getDirector()?.photoUrl || null)"
                  [alt]="
                    getDirector()
                      ? getEmployeeFullName(getDirector()!)
                      : 'Director'
                  "
                  class="w-12 h-12 rounded-full object-cover border border-gray-200"
                  (error)="onImageError($event)"
                />
                <ng-template #directorFallbackIcon>
                  <img
                    [src]="getDefaultImage(getDirector())"
                    [alt]="
                      getDirector()
                        ? getEmployeeFullName(getDirector()!)
                        : 'Director'
                    "
                    class="w-12 h-12 rounded-full object-cover border border-gray-200"
                  />
                </ng-template>
              </div>
              <div class="flex-1 text-left">
                <div class="font-semibold text-gray-900 text-sm">
                  {{
                    getDirector()
                      ? getEmployeeFullName(getDirector()!)
                      : "Director"
                  }}
                </div>
                <div class="text-xs text-gray-500">
                  {{ getDirectorDepartmentName() }}
                </div>
                <div class="text-xs text-gray-400">Director</div>
              </div>
            </div>

            <!-- Team Management Buttons -->
            <div class="flex justify-between pt-3 border-t border-gray-200">
              <button
                class="flex items-center space-x-1 text-green-600 hover:text-green-700 text-xs"
                (click)="openViewTeamModal(organizations[0].headDepartment)"
              >
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"
                  />
                </svg>
                <span>View Team ({{ getDirectorTeamCount() }})</span>
              </button>
              <button class="text-green-600 hover:text-green-700 text-xs">
                + Add
              </button>
            </div>
          </div>
        </div>

        <!-- Connection Lines to Departments -->
        <div *ngIf="getAllDepartments().length > 0" class="flex justify-center">
          <div class="w-px h-12 bg-gray-300"></div>
        </div>

        <!-- Departments Level -->
        <div
          *ngIf="getAllDepartments().length > 0"
          class="flex flex-wrap justify-center gap-8"
        >
          <div
            *ngFor="let department of getAllDepartments()"
            class="flex flex-col items-center space-y-4"
          >
            <!-- Vertical line from center to department -->
            <div class="w-px h-8 bg-gray-300"></div>

            <!-- Department Title Card -->
            <div
              class="w-64 bg-[#353535] text-white rounded-lg p-3 text-center"
            >
              <div class="font-semibold text-sm">{{ department.name }}</div>
              <div class="text-xs opacity-90">Department</div>
            </div>

            <!-- Department HOD Profile Card -->
            <div
              class="w-64 bg-white border border-gray-200 rounded-lg p-4 shadow-sm"
            >
              <div class="flex items-center space-x-3">
                <div class="relative w-12 h-12">
                  <img
                    *ngIf="
                      hasValidPhotoUrl(department.hod);
                      else departmentFallbackIcon
                    "
                    [src]="formatImageUrl(department.hod?.photoUrl || null)"
                    [alt]="
                      department.hod
                        ? getEmployeeFullName(department.hod)
                        : 'Department HOD'
                    "
                    class="w-12 h-12 rounded-full object-cover border border-gray-200"
                    (error)="onImageError($event)"
                  />
                  <ng-template #departmentFallbackIcon>
                    <img
                      [src]="getDefaultImage(department.hod)"
                      [alt]="
                        department.hod
                          ? getEmployeeFullName(department.hod)
                          : 'Department HOD'
                      "
                      class="w-12 h-12 rounded-full object-cover border border-gray-200"
                    />
                  </ng-template>
                </div>
                <div class="flex-1 text-left">
                  <div class="font-semibold text-gray-900 text-sm">
                    {{
                      department.hod
                        ? getEmployeeFullName(department.hod)
                        : "No HOD Assigned"
                    }}
                  </div>
                  <div class="text-xs text-gray-500">
                    {{ department.name }}
                  </div>
                  <div class="text-xs text-gray-400">Head of Department</div>
                </div>
              </div>

              <!-- Team Management Buttons -->
              <div class="flex justify-between pt-3 border-t border-gray-200">
                <button
                  class="flex items-center space-x-1 text-green-600 hover:text-green-700 text-xs"
                  (click)="openViewTeamModal(department)"
                >
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M13 6a3 3 0 11-6 0 3 3 0 616 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"
                    />
                  </svg>
                  <span>View Team ({{ department.members.length }})</span>
                </button>
                <button class="text-green-600 hover:text-green-700 text-xs">
                  + Add
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div
        *ngIf="organizations.length === 0 && !isLoading"
        class="text-center py-12"
      >
        <svg
          class="w-16 h-16 text-gray-400 mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
          />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          No Organization Structure Found
        </h3>
        <p class="text-gray-500">
          Get started by creating your first department.
        </p>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"
        ></div>
        <p class="mt-2 text-gray-500">Loading organization structure...</p>
      </div>
    </div>
  </div>

  <!-- User Management Tab Content -->
  <div *ngIf="activeTab === 'user-management'" class="bg-white min-h-screen">
    <div class="px-6 py-6">
      <div class="text-center py-12">
        <svg
          class="w-16 h-16 text-gray-400 mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"
          />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">User Management</h3>
        <p class="text-gray-500">
          User management functionality will be implemented here.
        </p>
      </div>
    </div>
  </div>

  <!-- Create Department Slide-out Modal -->
  <div
    *ngIf="showCreateDepartmentModal"
    class="fixed right-0 top-0 h-full w-96 bg-white shadow-xl transform transition-transform duration-300 z-50 border-l border-gray-200"
  >
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Add New Department</h3>
      <button
        (click)="closeCreateDepartmentModal()"
        class="text-gray-400 hover:text-gray-600"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-4">
      <!-- Department Name -->
      <div class="mb-6">
        <label
          for="departmentName"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Department Name *
        </label>
        <input
          type="text"
          id="departmentName"
          [(ngModel)]="newDepartment.name"
          placeholder="e.g., Marketing Department"
          class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"
        />
      </div>
    </div>

    <!-- Modal Footer -->
    <div
      class="absolute bottom-0 left-0 right-0 bg-gray-50 p-4 border-t border-gray-200"
    >
      <div class="flex space-x-3">
        <button
          type="button"
          (click)="closeCreateDepartmentModal()"
          class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50"
        >
          Cancel
        </button>
        <button
          type="button"
          (click)="submitCreateDepartment()"
          [disabled]="!newDepartment.name"
          class="flex-1 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Create Department
        </button>
      </div>
    </div>
  </div>

  <!-- Confirmation Prompt -->
  <app-confirm-prompt
    *ngIf="showConfirmPrompt"
    [text]="
      'Are you sure you want to create the department ' +
      newDepartment.name +
      '?'
    "
    [yesButtonText]="'Yes, Create'"
    [noButtonText]="'Cancel'"
    (confirmed)="onConfirmCreate()"
    (closed)="onCancelCreate()"
  ></app-confirm-prompt>

  <!-- Loading Overlay for Creation -->
  <app-loading-overlay
    *ngIf="isCreatingDepartment"
    [isVisible]="isCreatingDepartment"
    title="Creating Department..."
    message="Please wait while we create the department."
  ></app-loading-overlay>

  <!-- Team Details Modal using Employee Details Component -->
  <app-employee-details
    [view]="showTeamDetails"
    [employee]="selectedTeamData"
    [employeeDetails]="
      createEmployeeDetailsFromDepartment(selectedTeamDepartment)
    "
    [teamMembers]="selectedTeamDepartment?.members || []"
    [departmentName]="selectedTeamDepartment?.name || ''"
    (close)="closeViewTeamModal()"
  ></app-employee-details>
</div>
