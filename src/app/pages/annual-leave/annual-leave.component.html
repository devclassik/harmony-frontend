<!-- Loading Overlay -->
<app-loading-overlay
  [isVisible]="
    isLoadingLeaves || isCreatingLeave || isApprovingLeave || isRejectingLeave
  "
  [title]="
    isLoadingLeaves
      ? 'Loading Leave Requests...'
      : isCreatingLeave
      ? 'Creating Leave Request...'
      : isApprovingLeave
      ? 'Approving Leave Request...'
      : isRejectingLeave
      ? 'Rejecting Leave Request...'
      : 'Loading...'
  "
  [message]="
    isLoadingLeaves
      ? 'Please wait while we fetch your leave requests.'
      : isCreatingLeave
      ? 'Please wait while we process your leave request.'
      : isApprovingLeave
      ? 'Please wait while we approve the leave request.'
      : isRejectingLeave
      ? 'Please wait while we reject the leave request.'
      : 'Please wait...'
  "
></app-loading-overlay>

<!-- Admin/HOD/Pastor View -->
<div
  *ngIf="
    userRole?.toLowerCase() === 'admin' ||
    userRole?.toLowerCase() === 'hod' ||
    userRole?.toLowerCase() === 'pastor'
  "
>
  <div class="p-2">
    <app-table
      [tableTitle]="'Annual Leave'"
      [tableHeader]="tableHeader"
      [tableData]="filteredLeaveRequests"
      [showViewAll]="false"
      [showFilter]="showFilterTabFromParent"
      [showStatusTab]="true"
      [statusTabs]="statusTabs"
      [activeStatusTab]="selectedStatus"
      (statusTabChange)="onStatusTabChange($event)"
      [filterTabs]="filterTabs"
      [activeFilterTab]="selectedFilter"
      (filterTabChange)="onFilterTabChange($event)"
      [searchValue]="searchValue"
      (search)="onSearch($event)"
      [menuItems]="actionButton"
      (menuAction)="onMenuAction($event)"
      [showCalendar]="true"
      showCalendarIcon="assets/svg/calender2.svg"
      [showList]="true"
      showListIcon="assets/svg/list.svg"
      [calendarEvents]="leaveCalendarEvents"
      [customEventClick]="handleCalendarEventClick"
      [currentView]="currentView"
      (viewChange)="onViewChange($event)"
      [showList]="false"
    ></app-table>
  </div>

  <!-- Employee Details with Accordion View -->
  <app-employee-details
    [view]="showEmployeeDetails"
    [showButton]="true"
    [noButtonText]="'Reject'"
    [yesButtonText]="'Approve'"
    [yesButtonDisabled]="
      selectedLeaveRecord?.status?.toUpperCase() === 'APPROVED'
    "
    [noButtonDisabled]="
      selectedLeaveRecord?.status?.toUpperCase() === 'REJECTED'
    "
    (confirm)="actionToPerform($event)"
    (close)="showEmployeeDetails = false"
    [employee]="selectedEmployeeRecord"
    [employeeDetails]="selectedEmployeeDetails"
    [leaveData]="selectedLeaveData"
    [allLeaves]="selectedEmployeeLeaves"
    [leaveHistory]="selectedLeaveHistory"
    [leaveType]="'Annual Leave'"
  ></app-employee-details>
</div>

<!-- Worker View -->
<div
  *ngIf="
    userRole?.toLowerCase() === 'worker' ||
    userRole?.toLowerCase() === 'minister'
  "
>
  <div class="p-2">
    <app-table
      [tableTitle]="'Annual Leave'"
      [tableHeader]="leaveRequestsHeader"
      [tableData]="leaveRequests"
      [showViewAll]="false"
      [showFilter]="showFilterTabFromParent"
      [showStatusTab]="true"
      [statusTabs]="statusTabs"
      [activeStatusTab]="selectedStatus"
      (statusTabChange)="onStatusTabChange($event)"
      [filterTabs]="filterTabs"
      [activeFilterTab]="selectedFilter"
      (filterTabChange)="onFilterTabChange($event)"
      [searchValue]="searchValue"
      (search)="onSearch($event)"
      [tableData]="filteredLeaveRequests"
      [menuItems]="actionButton"
      (menuAction)="onMenuAction($event)"
      [showCalendar]="false"
      [showButton]="true"
      showButtonText="Create Request"
      showButtonIcon="assets/svg/add.svg"
      showButtonStyle="bg-gradient-to-r from-[#12C16F] to-[#0A8754] hover:from-[#0A8754] hover:to-[#12C16F]"
      (showButtonActionClick)="onCreateLeaveRequest()"
      [showList]="false"
    ></app-table>
  </div>
</div>

<!-- Leave Details Component (handles both view and create modes) -->
<app-leave-details
  [view]="showAnnualLeaveDetails || showCreateLeaveRequest"
  [leaveData]="selectedLeaveData"
  [title]="
    leaveDetailsMode === 'create'
      ? 'Create Annual Leave Request'
      : 'Annual Leave Details'
  "
  [leaveType]="'Annual Leave'"
  [showSubstitution]="false"
  [mode]="leaveDetailsMode"
  (close)="
    leaveDetailsMode === 'create'
      ? onCloseCreateLeaveRequest()
      : onCloseAnnualLeaveDetails()
  "
  (submit)="onCreateLeaveRequestSubmitted($event)"
></app-leave-details>

<app-confirm-prompt
  *ngIf="showModal"
  [title]="promptConfig?.title || ''"
  [text]="promptConfig?.text || ''"
  [imageUrl]="promptConfig?.imageUrl || null"
  [yesButtonText]="promptConfig?.yesButtonText || ''"
  [noButtonText]="promptConfig?.noButtonText || ''"
  (confirmed)="onModalConfirm($event)"
  (closed)="onModalClose()"
  [data]="selectedEmployeeRecord"
></app-confirm-prompt>

<app-substitution
  [open]="showSubstitution"
  (closed)="showSubstitution = false"
  (submitted)="handleSubstitution($event)"
></app-substitution>

<app-success-modal
  *ngIf="successModal"
  [title]="'Operation Successful!'"
  [showOkButton]="false"
  [okButtonText]="'Click Ok'"
  [okButtonLink]="'/dashboard'"
  (closed)="successModal = false"
></app-success-modal>
