<div class="fixed inset-0 z-50 flex justify-end bg-[#7f7f7f63]" *ngIf="view">
  <div
    class="bg-white w-full max-w-xl h-full shadow-lg p-8 overflow-y-auto relative animate-slide-in-right"
  >
    <button
      class="absolute top-6 right-6 text-gray-400 hover:text-black text-2xl"
      (click)="onClose()"
    >
      &times;
    </button>
    <div class="flex items-center gap-4 pb-6 border-b border-gray-100">
      <img
        class="size-32 rounded-full object-cover"
        [src]="formatImageUrl(employeeDetails?.photoUrl)"
        [alt]="
          (employeeDetails?.firstName || '') +
          ' ' +
          (employeeDetails?.lastName || '')
        "
        (error)="handleImageError($event)"
      />
      <div>
        <div
          class="font-semibold text-sm text-gray-900 flex items-center gap-2"
        >
          {{ employeeDetails?.firstName }} {{ employeeDetails?.lastName }}
          <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded ml-2"
            >Employee ID:
            <span class="font-medium">{{
              employeeDetails?.employeeId || employeeDetails?.id
            }}</span></span
          >
        </div>
        <div class="text-xs text-gray-600">
          {{ employeeDetails?.departments?.[0]?.name || "N/A" }}
        </div>
        <div class="text-xs text-gray-500">
          {{
            employeeDetails?.user?.role?.name || employeeDetails?.title || "N/A"
          }}
        </div>
      </div>
    </div>

    <hr class="text-[#ededed] mb-6" />
    <div class="employee-sections mt-6">
      <!-- Employee Information Section -->
      <div class="employee-section mb-4">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'employeeInfo'
              ? (openSection = null)
              : (openSection = 'employeeInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'employeeInfo' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Employee Information</span>
        </button>
        <div
          *ngIf="openSection === 'employeeInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Employee ID</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.employeeId || employeeDetails?.id || "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Title</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.title || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal First Name</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.firstName || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal Middle Name</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.middleName || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal Last Name</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.lastName || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">
                Preferred Name of Correspondence
              </div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.profferedName ||
                    employeeDetails?.firstName +
                      " " +
                      employeeDetails?.lastName ||
                    "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Gender</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.gender || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Department</div>
              <div class="font-medium text-gray-900">
                {{employeeDetails?.departments?.[0]?.name || 'N/A'}}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Role</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.user?.role?.name || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Employment Type</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.employmentType || "N/A" }}
              </div>
            </div>
            <div class="col-span-2 flex items-center mt-2">
              <div class="text-xs text-gray-400 mr-2">Status</div>
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                [ngClass]="{
                  'bg-green-100 text-green-700':
                    employeeDetails?.employeeStatus?.toLowerCase() === 'active',
                  'bg-yellow-100 text-yellow-700':
                    employeeDetails?.employeeStatus?.toLowerCase() ===
                    'on leave',
                  'bg-red-100 text-red-700':
                    employeeDetails?.employeeStatus?.toLowerCase() ===
                    'on discipline',
                  'bg-gray-100 text-gray-700':
                    employeeDetails?.employeeStatus?.toLowerCase() ===
                      'retired' || !employeeDetails?.employeeStatus
                }"
              >
                <span
                  class="w-2 h-2 rounded-full mr-2"
                  [ngClass]="{
                    'bg-green-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                      'active',
                    'bg-yellow-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                      'on leave',
                    'bg-red-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                      'on discipline',
                    'bg-gray-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                        'retired' || !employeeDetails?.employeeStatus
                  }"
                ></span>
                {{ employeeDetails?.employeeStatus || "N/A" }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- Contact Information Section - Hidden in promotion view -->
      <div class="employee-section mb-4" *ngIf="!promotionData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'contactInfo'
              ? (openSection = null)
              : (openSection = 'contactInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'contactInfo' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Contact Information</span>
        </button>
        <div
          *ngIf="openSection === 'contactInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Home Address</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.address || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">City/Town</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.city || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">State/Province</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.state || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Country</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.country || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">ZIP Code</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.zipCode || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Email</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.user?.email ||
                    employeeDetails?.altEmail ||
                    "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Phone Number</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.primaryPhone || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Alternative Phone Number</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.altPhone || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Service Start Date</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.serviceStartDate
                    ? (employeeDetails?.serviceStartDate | date : "shortDate")
                    : "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Employee Status</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.employeeStatus || "N/A" }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="employee-section mb-4" *ngIf="!promotionData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'personalInfo'
              ? (openSection = null)
              : (openSection = 'personalInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Personal Information</span>
        </button>
        <div
          *ngIf="openSection === 'personalInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Marital Status</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.maritalStatus || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Ever Divorced</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.everDivorced ? "Yes" : "No" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Date of Birth</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.dob
                    ? (employeeDetails?.dob | date : "shortDate")
                    : "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Spouse Information</div>
              <div class="font-medium text-gray-900">
                {{
                  (employeeDetails?.spouse?.firstName || "") +
                    " " +
                    (employeeDetails?.spouse?.lastName || "") || "N/A"
                }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="employee-section mb-4" *ngIf="!promotionData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'spiritualHistory'
              ? (openSection = null)
              : (openSection = 'spiritualHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'spiritualHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Spiritual History</span>
        </button>
        <div
          *ngIf="openSection === 'spiritualHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Baptism Date</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Baptism Location</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Church Membership</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Spiritual Gifts</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
          </div>
        </div>
      </div>
      <div class="employee-section mb-4" *ngIf="!promotionData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'areaOfService'
              ? (openSection = null)
              : (openSection = 'areaOfService')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'areaOfService' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Area Of Service</span>
        </button>
        <div
          *ngIf="openSection === 'areaOfService'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Current Department</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.departments?.[0]?.name || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Position</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.user?.role?.name || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Service Start Date</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.serviceStartDate
                    ? (employeeDetails?.serviceStartDate | date : "shortDate")
                    : "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Years of Service</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
          </div>
        </div>
      </div>
      <div class="employee-section mb-4" *ngIf="!promotionData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'legalQuestions'
              ? (openSection = null)
              : (openSection = 'legalQuestions')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'legalQuestions' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Legal Questions</span>
        </button>
        <div
          *ngIf="openSection === 'legalQuestions'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Criminal Record</div>
              <div class="font-medium text-gray-900">No</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal Issues</div>
              <div class="font-medium text-gray-900">None</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Background Check</div>
              <div class="font-medium text-gray-900">Cleared</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Compliance Status</div>
              <div class="font-medium text-gray-900">Compliant</div>
            </div>
          </div>
        </div>
      </div>
      <div class="employee-section mb-4" *ngIf="!promotionData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'documentInfo'
              ? (openSection = null)
              : (openSection = 'documentInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Document Repository</span>
        </button>
        <div
          *ngIf="openSection === 'documentInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Resume</div>
              <div class="font-medium text-gray-900">124-08</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Certificate</div>
              <div class="font-medium text-gray-900">Mr.</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Other</div>
              <div class="font-medium text-gray-900">John</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Other</div>
              <div class="font-medium text-gray-900">Tobi</div>
            </div>
          </div>
        </div>
      </div>
      <div class="employee-section mb-4">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'appraisalHistory'
              ? (openSection = null)
              : (openSection = 'appraisalHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'appraisalHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Evaluation History</span>
        </button>
        <div
          *ngIf="openSection === 'appraisalHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Last Appraisal Date</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Overall Rating</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Next Appraisal Due</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Performance Goals</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Promotion Request Section - Shows all promotion requests for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="allPromotions && allPromotions.length > 0"
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'promotionRequest'
              ? (openSection = null)
              : (openSection = 'promotionRequest')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'promotionRequest' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Promotion Request</span>
        </button>
        <div
          *ngIf="openSection === 'promotionRequest'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            class="space-y-4"
            *ngFor="let promotion of allPromotions; let i = index"
          >
            <div
              class="border border-gray-200 rounded-lg p-4"
              [class.border-blue-500]="promotion.id === promotionData?.id"
            >
              <!-- Two-column layout -->
              <div class="grid grid-cols-2 gap-4">
                <!-- Left Column - New Position -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    New Position
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ formatPosition(promotion.newPosition) }}
                  </div>
                </div>

                <!-- Right Column - Status -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Status
                  </div>
                  <div>
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                      [ngClass]="{
                        'bg-amber-100 text-amber-800':
                          promotion.status === 'PENDING',
                        'bg-green-100 text-green-800':
                          promotion.status === 'APPROVED',
                        'bg-orange-100 text-orange-800':
                          promotion.status === 'REJECTED'
                      }"
                    >
                      <span
                        class="w-2 h-2 rounded-full mr-2"
                        [ngClass]="{
                          'bg-amber-500': promotion.status === 'PENDING',
                          'bg-green-500': promotion.status === 'APPROVED',
                          'bg-orange-500': promotion.status === 'REJECTED'
                        }"
                      ></span>
                      {{
                        promotion.status === "PENDING"
                          ? "Pending"
                          : promotion.status === "APPROVED"
                          ? "Approved"
                          : "Rejected"
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="flex gap-3 w-2/3 m-auto" *ngIf="showButton">
        <button
          class="flex-1 px-4 py-3 border border-green-600 text-green-600 rounded-lg font-medium hover:bg-green-50 transition-colors"
          (click)="onConfirm(false)"
        >
          {{ noButtonText }}
        </button>
        <button
          class="flex-1 px-4 py-3 bg-gradient-to-r from-[#12C16F] to-[#0A8754] hover:from-[#0A8754] hover:to-[#12C16F] text-white rounded-lg font-medium transition-colors"
          (click)="onConfirm(true)"
        >
          {{ yesButtonText }}
        </button>
      </div>
    </div>
  </div>
  <button
    (click)="onClose()"
    class="absolute right-144 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white shadow flex items-center justify-center border border-gray-200 hover:bg-green-50 z-50"
    aria-label="Close"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 text-gray-500"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 5l7 7-7 7"
      />
    </svg>
  </button>
</div>

<!-- Tailwind rotate-180 utility for icon rotation -->
<style>
  .rotate-180 {
    transform: rotate(180deg);
  }
</style>
