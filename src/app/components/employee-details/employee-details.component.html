<div class="fixed inset-0 z-50 flex justify-end bg-[#7f7f7f63]" *ngIf="view">
  <div
    class="bg-white w-full max-w-xl h-full shadow-lg p-8 overflow-y-auto relative animate-slide-in-right"
  >
    <button
      class="absolute top-6 right-6 text-gray-400 hover:text-black text-2xl"
      (click)="onClose()"
    >
      &times;
    </button>
    <div class="flex items-center gap-4 pb-6 border-b border-gray-100">
      <img
        class="size-32 rounded-full object-cover"
        [src]="formatImageUrl(employeeDetails?.photoUrl)"
        [alt]="
          (employeeDetails?.firstName || '') +
          ' ' +
          (employeeDetails?.lastName || '')
        "
        (error)="handleImageError($event)"
      />
      <div>
        <div
          class="font-semibold text-sm text-gray-900 flex items-center gap-2"
        >
          {{ employeeDetails?.firstName }} {{ employeeDetails?.lastName }}
          <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded ml-2"
            >Employee ID:
            <span class="font-medium">{{
              employeeDetails?.employeeId || employeeDetails?.id
            }}</span></span
          >
        </div>
        <div class="text-xs text-gray-600">
          {{ employeeDetails?.departments?.[0]?.name || "N/A" }}
        </div>
        <div class="text-xs text-gray-500">
          {{ employeeDetails?.user?.role?.name || "N/A" }}
        </div>
      </div>
    </div>

    <hr class="text-[#ededed] mb-6" />
    <div class="employee-sections mt-6">
      <!-- Employee Information Section -->
      <div class="employee-section mb-4">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'employeeInfo'
              ? (openSection = null)
              : (openSection = 'employeeInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'employeeInfo' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Employee Information</span>
        </button>
        <div
          *ngIf="openSection === 'employeeInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Employee ID</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.employeeId || employeeDetails?.id || "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Title</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.title || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal First Name</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.firstName || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal Middle Name</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.middleName || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal Last Name</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.lastName || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">
                Preferred Name of Correspondence
              </div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.profferedName ||
                    employeeDetails?.firstName +
                      " " +
                      employeeDetails?.lastName ||
                    "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Gender</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.gender || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Department</div>
              <div class="font-medium text-gray-900">
                {{employeeDetails?.departments?.[0]?.name || 'N/A'}}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Role</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.user?.role?.name || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Employment Type</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.employmentType || "N/A" }}
              </div>
            </div>
            <div class="col-span-2 flex items-center mt-2">
              <div class="text-xs text-gray-400 mr-2">Status</div>
              <span
                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                [ngClass]="{
                  'bg-green-100 text-green-700':
                    employeeDetails?.employeeStatus?.toLowerCase() === 'active',
                  'bg-yellow-100 text-yellow-700':
                    employeeDetails?.employeeStatus?.toLowerCase() ===
                    'on leave',
                  'bg-red-100 text-red-700':
                    employeeDetails?.employeeStatus?.toLowerCase() ===
                    'on discipline',
                  'bg-gray-100 text-gray-700':
                    employeeDetails?.employeeStatus?.toLowerCase() ===
                      'retired' || !employeeDetails?.employeeStatus
                }"
              >
                <span
                  class="w-2 h-2 rounded-full mr-2"
                  [ngClass]="{
                    'bg-green-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                      'active',
                    'bg-yellow-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                      'on leave',
                    'bg-red-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                      'on discipline',
                    'bg-gray-500':
                      employeeDetails?.employeeStatus?.toLowerCase() ===
                        'retired' || !employeeDetails?.employeeStatus
                  }"
                ></span>
                {{ employeeDetails?.employeeStatus || "N/A" }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- Contact Information Section - Hidden in promotion view -->
      <div
        class="employee-section mb-4"
        *ngIf="
          !promotionData &&
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'contactInfo'
              ? (openSection = null)
              : (openSection = 'contactInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'contactInfo' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Contact Information</span>
        </button>
        <div
          *ngIf="openSection === 'contactInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Home Address</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.address || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">City/Town</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.city || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">State/Province</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.state || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Country</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.country || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">ZIP Code</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.homeAddress?.zipCode || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Email</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.user?.email ||
                    employeeDetails?.altEmail ||
                    "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Phone Number</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.primaryPhone || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Alternative Phone Number</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.altPhone || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Service Start Date</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.serviceStartDate
                    ? (employeeDetails?.serviceStartDate | date : "shortDate")
                    : "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Employee Status</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.employeeStatus || "N/A" }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="employee-section mb-4"
        *ngIf="
          !promotionData &&
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'personalInfo'
              ? (openSection = null)
              : (openSection = 'personalInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Personal Information</span>
        </button>
        <div
          *ngIf="openSection === 'personalInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Marital Status</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.maritalStatus || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Ever Divorced</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.everDivorced ? "Yes" : "No" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Date of Birth</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.dob
                    ? (employeeDetails?.dob | date : "shortDate")
                    : "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Spouse Information</div>
              <div class="font-medium text-gray-900">
                {{
                  (employeeDetails?.spouse?.firstName || "") +
                    " " +
                    (employeeDetails?.spouse?.lastName || "") || "N/A"
                }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="employee-section mb-4"
        *ngIf="
          !promotionData &&
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'spiritualHistory'
              ? (openSection = null)
              : (openSection = 'spiritualHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'spiritualHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Spiritual History</span>
        </button>
        <div
          *ngIf="openSection === 'spiritualHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Baptism Date</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Baptism Location</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Church Membership</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Spiritual Gifts</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="employee-section mb-4"
        *ngIf="
          !promotionData &&
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'areaOfService'
              ? (openSection = null)
              : (openSection = 'areaOfService')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'areaOfService' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Area Of Service</span>
        </button>
        <div
          *ngIf="openSection === 'areaOfService'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Current Department</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.departments?.[0]?.name || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Position</div>
              <div class="font-medium text-gray-900">
                {{ employeeDetails?.user?.role?.name || "N/A" }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Service Start Date</div>
              <div class="font-medium text-gray-900">
                {{
                  employeeDetails?.serviceStartDate
                    ? (employeeDetails?.serviceStartDate | date : "shortDate")
                    : "N/A"
                }}
              </div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Years of Service</div>
              <div class="font-medium text-gray-900">N/A</div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="employee-section mb-4"
        *ngIf="
          !promotionData &&
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'legalQuestions'
              ? (openSection = null)
              : (openSection = 'legalQuestions')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'legalQuestions' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Legal Questions</span>
        </button>
        <div
          *ngIf="openSection === 'legalQuestions'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Criminal Record</div>
              <div class="font-medium text-gray-900">No</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Legal Issues</div>
              <div class="font-medium text-gray-900">None</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Background Check</div>
              <div class="font-medium text-gray-900">Cleared</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Compliance Status</div>
              <div class="font-medium text-gray-900">Compliant</div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="employee-section mb-4"
        *ngIf="
          !promotionData &&
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'documentInfo'
              ? (openSection = null)
              : (openSection = 'documentInfo')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Document Repository</span>
        </button>
        <div
          *ngIf="openSection === 'documentInfo'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="grid grid-cols-2 gap-x-8 gap-y-4">
            <div>
              <div class="text-xs text-gray-400">Resume</div>
              <div class="font-medium text-gray-900">124-08</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Certificate</div>
              <div class="font-medium text-gray-900">Mr.</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Other</div>
              <div class="font-medium text-gray-900">John</div>
            </div>
            <div>
              <div class="text-xs text-gray-400">Other</div>
              <div class="font-medium text-gray-900">Tobi</div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="employee-section mb-4"
        *ngIf="
          !disciplineData &&
          !transferData &&
          !retirementData &&
          !promotionData &&
          !retrenchmentData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'appraisalHistory'
              ? (openSection = null)
              : (openSection = 'appraisalHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'appraisalHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Evaluation History</span>
        </button>
        <div
          *ngIf="openSection === 'appraisalHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="appraisalData && appraisalData.length > 0; else noAppraisals"
          >
            <div
              *ngFor="let appraisal of appraisalData; let i = index"
              class="border border-gray-200 rounded-lg p-4 mb-4"
            >
              <div class="grid grid-cols-2 gap-x-8 gap-y-4 mb-4">
                <div>
                  <div class="text-xs text-gray-400">Start Date</div>
                  <div class="font-medium text-gray-900">
                    {{ appraisal.startDate | date : "shortDate" }}
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-400">End Date</div>
                  <div class="font-medium text-gray-900">
                    {{ appraisal.endDate | date : "shortDate" }}
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-400">Average Score</div>
                  <div class="font-medium text-gray-900">
                    {{ appraisal.averageScore }}%
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-400">Total Criteria</div>
                  <div class="font-medium text-gray-900">
                    {{ appraisal.scores?.length || 0 }}
                  </div>
                </div>
              </div>

              <!-- Individual Scores -->
              <div
                *ngIf="appraisal.scores && appraisal.scores.length > 0"
                class="mt-4"
              >
                <h4 class="text-sm font-semibold text-gray-700 mb-3">
                  Individual Scores
                </h4>
                <div class="grid grid-cols-3 gap-4">
                  <div
                    *ngFor="let score of appraisal.scores"
                    class="bg-gray-50 p-3 rounded-lg"
                  >
                    <div class="text-xs text-gray-500 mb-1">
                      {{ formatCriteria(score.criterial) }}
                    </div>
                    <div class="text-lg font-semibold text-gray-900">
                      {{ score.score }}%
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noAppraisals>
            <div class="text-center py-8 text-gray-500">
              <p>No evaluation history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Discipline History Section - Shows discipline history for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="
          disciplineData &&
          ((allDisciplines && allDisciplines.length > 0) ||
            (disciplineHistory && disciplineHistory.length > 0))
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'disciplineHistory'
              ? (openSection = null)
              : (openSection = 'disciplineHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'disciplineHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Discipline History</span>
        </button>
        <div
          *ngIf="openSection === 'disciplineHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="
              allDisciplines && allDisciplines.length > 0;
              else noDisciplineHistory
            "
          >
            <div
              *ngFor="let discipline of allDisciplines; let i = index"
              class="border border-gray-200 rounded-lg p-4 mb-4 space-y-4"
              [class.border-blue-500]="discipline.id === disciplineData.id"
            >
              <div class="grid grid-cols-2 gap-4">
                <!-- Left Column - New Position -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">Date</div>
                  <div class="font-semibold text-gray-900">
                    {{ discipline.createdAt | date : "shortDate" }}
                  </div>
                </div>

                <!-- Right Column - Status -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Type of Discipline
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ formatDisciplineType(discipline.disciplineType) }}
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <!-- Left Column - New Position -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Status
                  </div>
                  <div>
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                      [ngClass]="{
                        'bg-amber-100 text-amber-800':
                          discipline.status === 'PENDING',
                        'bg-green-100 text-green-800':
                          discipline.status === 'APPROVED',
                        'bg-orange-100 text-orange-800':
                          discipline.status === 'REJECTED'
                      }"
                    >
                      <span
                        class="w-2 h-2 rounded-full mr-2"
                        [ngClass]="{
                          'bg-amber-500': discipline.status === 'PENDING',
                          'bg-green-500': discipline.status === 'APPROVED',
                          'bg-orange-500': discipline.status === 'REJECTED'
                        }"
                      ></span>
                      {{
                        discipline.status === "PENDING"
                          ? "Pending"
                          : discipline.status === "APPROVED"
                          ? "Approved"
                          : "Rejected"
                      }}
                    </span>
                  </div>
                </div>

                <!-- Right Column - Status -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Duration of Discipline
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ discipline.duration }}
                    {{ formatDurationUnit(discipline.durationUnit) }}
                  </div>
                </div>
              </div>

              <!-- Reason -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
                <div class="font-semibold text-gray-900">
                  {{ discipline.reason }}
                </div>
              </div>
            </div>
          </div>

          <ng-template #noDisciplineHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No discipline history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Promotion Request Section - Shows all promotion requests for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="allPromotions && allPromotions.length > 0"
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'promotionRequest'
              ? (openSection = null)
              : (openSection = 'promotionRequest')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'promotionRequest' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Promotion Request</span>
        </button>
        <div
          *ngIf="openSection === 'promotionRequest'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            class="space-y-4"
            *ngFor="let promotion of allPromotions; let i = index"
          >
            <div
              class="border border-gray-200 rounded-lg p-4"
              [class.border-blue-500]="promotion.id === promotionData?.id"
            >
              <!-- Two-column layout -->
              <div class="grid grid-cols-2 gap-4">
                <!-- Left Column - New Position -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    New Position
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ formatPosition(promotion.newPosition) }}
                  </div>
                </div>

                <!-- Right Column - Status -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Status
                  </div>
                  <div>
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                      [ngClass]="{
                        'bg-amber-100 text-amber-800':
                          promotion.status === 'PENDING',
                        'bg-green-100 text-green-800':
                          promotion.status === 'APPROVED',
                        'bg-orange-100 text-orange-800':
                          promotion.status === 'REJECTED'
                      }"
                    >
                      <span
                        class="w-2 h-2 rounded-full mr-2"
                        [ngClass]="{
                          'bg-amber-500': promotion.status === 'PENDING',
                          'bg-green-500': promotion.status === 'APPROVED',
                          'bg-orange-500': promotion.status === 'REJECTED'
                        }"
                      ></span>
                      {{
                        promotion.status === "PENDING"
                          ? "Pending"
                          : promotion.status === "APPROVED"
                          ? "Approved"
                          : "Rejected"
                      }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Transfer History Section - Shows transfer history for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="
          !retirementData &&
          !retrenchmentData &&
          !promotionData &&
          !disciplineData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'transferHistory'
              ? (openSection = null)
              : (openSection = 'transferHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'transferHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Transfer History</span>
        </button>
        <div
          *ngIf="openSection === 'transferHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="
              transferHistory && transferHistory.length > 0;
              else noTransferHistory
            "
          >
            <div
              *ngFor="let transfer of transferHistory; let i = index"
              class="border border-gray-200 rounded-lg p-4 mb-4 space-y-4"
              [class.border-blue-500]="transfer.id === transferData?.id"
            >
              <!-- Date and Transfer Type on same line -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">Date</div>
                  <div class="font-semibold text-gray-900">
                    {{ transfer.createdAt | date : "shortDate" }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Transfer Type
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ formatTransferType(transfer.transferType) }}
                  </div>
                </div>
              </div>

              <!-- Destination on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Destination
                </div>
                <div class="font-semibold text-gray-900">
                  {{ transfer.destination || "N/A" }}
                </div>
              </div>

              <!-- Reason on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
                <div class="font-semibold text-gray-900">
                  {{ transfer.reason || "N/A" }}
                </div>
              </div>

              <!-- Status on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        transfer.status === 'PENDING',
                      'bg-green-100 text-green-800':
                        transfer.status === 'APPROVED',
                      'bg-orange-100 text-orange-800':
                        transfer.status === 'REJECTED'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': transfer.status === 'PENDING',
                        'bg-green-500': transfer.status === 'APPROVED',
                        'bg-orange-500': transfer.status === 'REJECTED'
                      }"
                    ></span>
                    {{
                      transfer.status === "PENDING"
                        ? "Pending"
                        : transfer.status === "APPROVED"
                        ? "Approved"
                        : "Rejected"
                    }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noTransferHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No transfer history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Transfer Request Section - Shows all transfer requests for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="allTransfers && allTransfers.length > 0"
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'transferRequest'
              ? (openSection = null)
              : (openSection = 'transferRequest')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'transferRequest' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Transfer Request</span>
        </button>
        <div
          *ngIf="openSection === 'transferRequest'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            class="space-y-4"
            *ngFor="let transfer of allTransfers; let i = index"
          >
            <div
              class="border border-gray-200 rounded-lg p-4"
              [class.border-blue-500]="transfer.id === transferData?.id"
            >
              <!-- Date and Transfer Type on same line -->
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">Date</div>
                  <div class="font-semibold text-gray-900">
                    {{ transfer.createdAt | date : "shortDate" }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Transfer Type
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ formatTransferType(transfer.transferType) }}
                  </div>
                </div>
              </div>

              <!-- Destination on next line -->
              <div class="mb-4">
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Destination
                </div>
                <div class="font-semibold text-gray-900">
                  {{ transfer.destination || "N/A" }}
                </div>
              </div>

              <!-- Reason on next line -->
              <div class="mb-4">
                <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
                <div class="font-semibold text-gray-900">
                  {{ transfer.reason || "N/A" }}
                </div>
              </div>

              <!-- Status on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        transfer.status === 'PENDING',
                      'bg-green-100 text-green-800':
                        transfer.status === 'APPROVED',
                      'bg-orange-100 text-orange-800':
                        transfer.status === 'REJECTED'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': transfer.status === 'PENDING',
                        'bg-green-500': transfer.status === 'APPROVED',
                        'bg-orange-500': transfer.status === 'REJECTED'
                      }"
                    ></span>
                    {{
                      transfer.status === "PENDING"
                        ? "Pending"
                        : transfer.status === "APPROVED"
                        ? "Approved"
                        : "Rejected"
                    }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Retirement History Section - Shows retirement history for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="
          !retrenchmentData &&
          !transferData &&
          !promotionData &&
          !disciplineData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'retirementHistory'
              ? (openSection = null)
              : (openSection = 'retirementHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'retirementHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Retirement History</span>
        </button>
        <div
          *ngIf="openSection === 'retirementHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="
              allRetirements && allRetirements.length > 0;
              else noRetirementHistory
            "
          >
            <div
              *ngFor="let retirement of allRetirements; let i = index"
              class="border border-gray-200 rounded-lg p-4 mb-4 space-y-4"
              [class.border-blue-500]="retirement.id === retirementData?.id"
            >
              <!-- Leave ID and Employee Name on same line -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Leave ID
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ retirement.retirementId || "N/A" }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Employee Name
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ retirement.employee.firstName }}
                    {{ retirement.employee.lastName }}
                  </div>
                </div>
              </div>

              <!-- Replacement Recommendation and Request Date on same line -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Replacement Recommendation
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ retirement.recommendedReplacement.firstName }}
                    {{ retirement.recommendedReplacement.lastName }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Request Date
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ retirement.createdAt | date : "shortDate" }}
                  </div>
                </div>
              </div>

              <!-- Reason on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
                <div class="font-semibold text-gray-900">
                  {{ retirement.reason || "N/A" }}
                </div>
              </div>

              <!-- Status on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        retirement.status === 'PENDING',
                      'bg-green-100 text-green-800':
                        retirement.status === 'APPROVED',
                      'bg-orange-100 text-orange-800':
                        retirement.status === 'REJECTED'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': retirement.status === 'PENDING',
                        'bg-green-500': retirement.status === 'APPROVED',
                        'bg-orange-500': retirement.status === 'REJECTED'
                      }"
                    ></span>
                    {{
                      retirement.status === "PENDING"
                        ? "Pending"
                        : retirement.status === "APPROVED"
                        ? "Approved"
                        : "Rejected"
                    }}
                  </span>
                </div>
              </div>

              <!-- Documents section - only show if status is not rejected -->
              <div
                *ngIf="
                  retirement.status !== 'REJECTED' &&
                  retirement.documents &&
                  retirement.documents.length > 0
                "
              >
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Documents
                </div>
                <div class="space-y-2">
                  <div
                    *ngFor="
                      let document of retirement.documents;
                      let docIndex = index
                    "
                    class="flex items-center justify-between p-2 bg-gray-50 rounded border"
                  >
                    <span class="text-sm text-gray-700">
                      Document {{ docIndex + 1 }}
                    </span>
                    <button
                      class="text-blue-600 hover:text-blue-800 text-sm font-medium"
                      (click)="openPdfModal(document)"
                    >
                      View
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noRetirementHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No retirement history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Retrenchment History Section - Shows retrenchment history for this employee -->
      <div
        class="employee-section mb-4"
        *ngIf="
          !retirementData &&
          !transferData &&
          !promotionData &&
          !disciplineData &&
          !leaveData &&
          !absenceData &&
          !sickData
        "
      >
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'retrenchmentHistory'
              ? (openSection = null)
              : (openSection = 'retrenchmentHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'retrenchmentHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Retrenchment History</span>
        </button>
        <div
          *ngIf="openSection === 'retrenchmentHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="
              allRetrenchments && allRetrenchments.length > 0;
              else noRetrenchmentHistory
            "
          >
            <div
              *ngFor="let retrenchment of allRetrenchments; let i = index"
              class="border border-gray-200 rounded-lg p-4 mb-4 space-y-4"
              [class.border-blue-500]="retrenchment.id === retrenchmentData?.id"
            >
              <!-- Employee Name and Retrenchment Type on same line -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Employee Name
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ retrenchment.employee.firstName }}
                    {{ retrenchment.employee.lastName }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Retrenchment Type
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ formatRetrenchmentType(retrenchment.retrenchmentType) }}
                  </div>
                </div>
              </div>

              <!-- Reason on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
                <div class="font-semibold text-gray-900">
                  {{ retrenchment.reason || "N/A" }}
                </div>
              </div>

              <!-- Status on next line -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        retrenchment.status === 'PENDING',
                      'bg-green-100 text-green-800':
                        retrenchment.status === 'APPROVED',
                      'bg-orange-100 text-orange-800':
                        retrenchment.status === 'REJECTED'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': retrenchment.status === 'PENDING',
                        'bg-green-500': retrenchment.status === 'APPROVED',
                        'bg-orange-500': retrenchment.status === 'REJECTED'
                      }"
                    ></span>
                    {{
                      retrenchment.status === "PENDING"
                        ? "Pending"
                        : retrenchment.status === "APPROVED"
                        ? "Approved"
                        : "Rejected"
                    }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noRetrenchmentHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No retrenchment history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Leave History Section -->
      <div class="employee-section mb-4" *ngIf="leaveData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'leaveHistory'
              ? (openSection = null)
              : (openSection = 'leaveHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'leaveHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">{{ leaveType }} History</span>
        </button>
        <div
          *ngIf="openSection === 'leaveHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div *ngIf="allLeaves && allLeaves.length > 0; else noLeaveHistory">
            <div
              *ngFor="let leave of allLeaves; let i = index"
              class="border border-gray-200 rounded-lg p-4 mb-4 space-y-4"
              [class.border-blue-500]="leave.id === leaveData?.id"
            >
              <!-- Leave Type and Status on same line -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Leave Type
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ leave.type || "Annual Leave" }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Status
                  </div>
                  <div>
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                      [ngClass]="{
                        'bg-amber-100 text-amber-800':
                          leave.status === 'PENDING',
                        'bg-green-100 text-green-800':
                          leave.status === 'APPROVED',
                        'bg-red-100 text-red-800': leave.status === 'REJECTED'
                      }"
                    >
                      <span
                        class="w-2 h-2 rounded-full mr-2"
                        [ngClass]="{
                          'bg-amber-500': leave.status === 'PENDING',
                          'bg-green-500': leave.status === 'APPROVED',
                          'bg-red-500': leave.status === 'REJECTED'
                        }"
                      ></span>
                      {{
                        leave.status === "PENDING"
                          ? "Pending"
                          : leave.status === "APPROVED"
                          ? "Approved"
                          : "Rejected"
                      }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Start Date and Duration on same line -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Start Date
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ leave.startDate | date : "shortDate" }}
                  </div>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Duration
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ leave.duration }} {{ leave.durationUnit }}
                  </div>
                </div>
              </div>

              <!-- Reason -->
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
                <div class="font-semibold text-gray-900">
                  {{ leave.reason || "N/A" }}
                </div>
              </div>
            </div>
          </div>

          <ng-template #noLeaveHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No leave history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Annual Leave Request Section -->
      <div class="employee-section mb-4" *ngIf="leaveData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'leaveRequest'
              ? (openSection = null)
              : (openSection = 'leaveRequest')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'leaveRequest' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">{{ leaveType }} Request</span>
        </button>
        <div
          *ngIf="openSection === 'leaveRequest'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="space-y-4">
            <!-- Employee Name and Leave Type on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Employee Name
                </div>
                <div class="font-semibold text-gray-900">
                  {{ leaveData.employeeName || "N/A" }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Leave Type
                </div>
                <div class="font-semibold text-gray-900">
                  {{ leaveData.requestType || leaveType }}
                </div>
              </div>
            </div>

            <!-- Start Date and End Date on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Start Date
                </div>
                <div class="font-semibold text-gray-900">
                  {{ leaveData.startDate }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  End Date
                </div>
                <div class="font-semibold text-gray-900">
                  {{ leaveData.endDate }}
                </div>
              </div>
            </div>

            <!-- Duration and Status on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Duration
                </div>
                <div class="font-semibold text-gray-900">
                  {{ leaveData.duration }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        leaveData.status === 'Pending',
                      'bg-green-100 text-green-800':
                        leaveData.status === 'Approved',
                      'bg-red-100 text-red-800': leaveData.status === 'Rejected'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': leaveData.status === 'Pending',
                        'bg-green-500': leaveData.status === 'Approved',
                        'bg-red-500': leaveData.status === 'Rejected'
                      }"
                    ></span>
                    {{ leaveData.status }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Reason -->
            <div>
              <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
              <div class="font-semibold text-gray-900">
                {{ leaveData.reason || "N/A" }}
              </div>
            </div>

            <!-- Leave Balance Information -->
            <div
              *ngIf="leaveData.totalLeaveDays !== undefined"
              class="bg-gray-50 p-4 rounded-lg"
            >
              <div class="text-sm font-medium text-gray-600 mb-3">
                Leave Balance
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <div class="text-xs text-gray-500">Total Allowance</div>
                  <div class="font-semibold text-gray-900">
                    {{ leaveData.totalLeaveDays }} days
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-500">Used Days</div>
                  <div class="font-semibold text-gray-900">
                    {{ leaveData.usedLeaveDays }} days
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-500">Remaining</div>
                  <div class="font-semibold text-gray-900">
                    {{ leaveData.remainingLeaveDays }} days
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Leave of Absence History Section -->
      <div class="employee-section mb-4" *ngIf="absenceData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'absenceHistory'
              ? (openSection = null)
              : (openSection = 'absenceHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'absenceHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Leave of Absence History</span>
        </button>
        <div
          *ngIf="openSection === 'absenceHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="allAbsences && allAbsences.length > 0; else noAbsenceHistory"
          >
            <div class="space-y-4">
              <div
                *ngFor="let absence of allAbsences"
                class="border border-gray-200 rounded-lg p-4 cursor-pointer transition-colors"
                [class.border-blue-500]="absence.id === absenceData?.id"
              >
                <!-- Start Date and Duration on same line -->
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <div class="text-sm font-medium text-gray-600 mb-2">
                      Start Date
                    </div>
                    <div class="font-semibold text-gray-900">
                      {{ absence.startDate | date : "shortDate" }}
                    </div>
                  </div>
                  <div>
                    <div class="text-sm font-medium text-gray-600 mb-2">
                      Duration
                    </div>
                    <div class="font-semibold text-gray-900">
                      {{ absence.duration }} {{ absence.durationUnit }}
                    </div>
                  </div>
                </div>

                <!-- Reason -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Reason
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ absence.reason || "N/A" }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noAbsenceHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No leave of absence history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Leave of Absence Request Section -->
      <div class="employee-section mb-4" *ngIf="absenceData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'absenceRequest'
              ? (openSection = null)
              : (openSection = 'absenceRequest')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'absenceRequest' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Leave of Absence Request</span>
        </button>
        <div
          *ngIf="openSection === 'absenceRequest'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="space-y-4">
            <!-- Employee Name and Leave Type on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Employee Name
                </div>
                <div class="font-semibold text-gray-900">
                  {{ absenceData.employeeName || "N/A" }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Leave Type
                </div>
                <div class="font-semibold text-gray-900">
                  {{ absenceData.requestType || "Leave of Absence" }}
                </div>
              </div>
            </div>

            <!-- Start Date and End Date on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Start Date
                </div>
                <div class="font-semibold text-gray-900">
                  {{ absenceData.startDate }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  End Date
                </div>
                <div class="font-semibold text-gray-900">
                  {{ absenceData.endDate }}
                </div>
              </div>
            </div>

            <!-- Duration and Status on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Duration
                </div>
                <div class="font-semibold text-gray-900">
                  {{ absenceData.duration }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        absenceData.status === 'Pending',
                      'bg-green-100 text-green-800':
                        absenceData.status === 'Approved',
                      'bg-red-100 text-red-800':
                        absenceData.status === 'Rejected'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': absenceData.status === 'Pending',
                        'bg-green-500': absenceData.status === 'Approved',
                        'bg-red-500': absenceData.status === 'Rejected'
                      }"
                    ></span>
                    {{ absenceData.status }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Reason -->
            <div>
              <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
              <div class="font-semibold text-gray-900">
                {{ absenceData.reason || "N/A" }}
              </div>
            </div>

            <!-- Leave Balance Information -->
            <div
              *ngIf="absenceData.totalLeaveDays !== undefined"
              class="bg-gray-50 p-4 rounded-lg"
            >
              <div class="text-sm font-medium text-gray-600 mb-3">
                Leave Balance
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <div class="text-xs text-gray-500">Total Allowance</div>
                  <div class="font-semibold text-gray-900">
                    {{ absenceData.totalLeaveDays }} days
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-500">Used Days</div>
                  <div class="font-semibold text-gray-900">
                    {{ absenceData.usedLeaveDays }} days
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-500">Remaining</div>
                  <div class="font-semibold text-gray-900">
                    {{ absenceData.remainingLeaveDays }} days
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sick Leave History Section -->
      <div class="employee-section mb-4" *ngIf="sickData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'sickHistory'
              ? (openSection = null)
              : (openSection = 'sickHistory')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'sickHistory' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Sick Leave History</span>
        </button>
        <div
          *ngIf="openSection === 'sickHistory'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div
            *ngIf="
              allSickLeaves && allSickLeaves.length > 0;
              else noSickHistory
            "
          >
            <div class="space-y-4">
              <div
                *ngFor="let sickLeave of allSickLeaves"
                class="border border-gray-200 rounded-lg p-4 cursor-pointer transition-colors"
                [class.border-blue-500]="sickLeave.id === sickData?.id"
              >
                <!-- Start Date and Duration on same line -->
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <div class="text-sm font-medium text-gray-600 mb-2">
                      Start Date
                    </div>
                    <div class="font-semibold text-gray-900">
                      {{ sickLeave.startDate | date : "shortDate" }}
                    </div>
                  </div>
                  <div>
                    <div class="text-sm font-medium text-gray-600 mb-2">
                      Duration
                    </div>
                    <div class="font-semibold text-gray-900">
                      {{ sickLeave.duration }} {{ sickLeave.durationUnit }}
                    </div>
                  </div>
                </div>

                <!-- Reason -->
                <div>
                  <div class="text-sm font-medium text-gray-600 mb-2">
                    Reason
                  </div>
                  <div class="font-semibold text-gray-900">
                    {{ sickLeave.reason || "N/A" }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noSickHistory>
            <div class="text-center py-8 text-gray-500">
              <p>No sick leave history available</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Sick Leave Request Section -->
      <div class="employee-section mb-4" *ngIf="sickData">
        <button
          class="flex items-center w-full text-left py-2 px-1 focus:outline-none"
          (click)="
            openSection === 'sickRequest'
              ? (openSection = null)
              : (openSection = 'sickRequest')
          "
        >
          <svg
            class="w-5 h-5 mr-2 transition-transform duration-200"
            [ngClass]="{ 'rotate-180': openSection === 'sickRequest' }"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
          <span class="font-medium text-black">Sick Leave Request</span>
        </button>
        <div
          *ngIf="openSection === 'sickRequest'"
          class="mt-4 bg-white p-6 animate-fade-in"
        >
          <div class="space-y-4">
            <!-- Employee Name and Leave Type on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Employee Name
                </div>
                <div class="font-semibold text-gray-900">
                  {{ sickData.employeeName || "N/A" }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Leave Type
                </div>
                <div class="font-semibold text-gray-900">
                  {{ sickData.requestType || "Sick Leave" }}
                </div>
              </div>
            </div>

            <!-- Start Date and End Date on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Start Date
                </div>
                <div class="font-semibold text-gray-900">
                  {{ sickData.startDate }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  End Date
                </div>
                <div class="font-semibold text-gray-900">
                  {{ sickData.endDate }}
                </div>
              </div>
            </div>

            <!-- Duration and Status on same line -->
            <div class="grid grid-cols-2 gap-4">
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">
                  Duration
                </div>
                <div class="font-semibold text-gray-900">
                  {{ sickData.duration }}
                </div>
              </div>
              <div>
                <div class="text-sm font-medium text-gray-600 mb-2">Status</div>
                <div>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-amber-100 text-amber-800':
                        sickData.status === 'Pending',
                      'bg-green-100 text-green-800':
                        sickData.status === 'Approved',
                      'bg-red-100 text-red-800': sickData.status === 'Rejected'
                    }"
                  >
                    <span
                      class="w-2 h-2 rounded-full mr-2"
                      [ngClass]="{
                        'bg-amber-500': sickData.status === 'Pending',
                        'bg-green-500': sickData.status === 'Approved',
                        'bg-red-500': sickData.status === 'Rejected'
                      }"
                    ></span>
                    {{ sickData.status }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Reason -->
            <div>
              <div class="text-sm font-medium text-gray-600 mb-2">Reason</div>
              <div class="font-semibold text-gray-900">
                {{ sickData.reason || "N/A" }}
              </div>
            </div>

            <!-- Leave Balance Information -->
            <div
              *ngIf="sickData.totalLeaveDays !== undefined"
              class="bg-gray-50 p-4 rounded-lg"
            >
              <div class="text-sm font-medium text-gray-600 mb-3">
                Leave Balance
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <div class="text-xs text-gray-500">Total Allowance</div>
                  <div class="font-semibold text-gray-900">
                    {{ sickData.totalLeaveDays }} days
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-500">Used Days</div>
                  <div class="font-semibold text-gray-900">
                    {{ sickData.usedLeaveDays }} days
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-500">Remaining</div>
                  <div class="font-semibold text-gray-900">
                    {{ sickData.remainingLeaveDays }} days
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex gap-3 w-2/3 m-auto" *ngIf="showButton">
        <button
          class="flex-1 px-4 py-3 border border-green-600 text-green-600 rounded-lg font-medium transition-colors"
          [class.opacity-50]="noButtonDisabled"
          [class.cursor-not-allowed]="noButtonDisabled"
          [class.hover:bg-green-50]="!noButtonDisabled"
          [disabled]="noButtonDisabled"
          (click)="onConfirm(false)"
        >
          {{ noButtonText }}
        </button>
        <button
          class="flex-1 px-4 py-3 bg-gradient-to-r from-[#12C16F] to-[#0A8754] text-white rounded-lg font-medium transition-colors"
          [class.opacity-50]="yesButtonDisabled"
          [class.cursor-not-allowed]="yesButtonDisabled"
          [class.hover:from-[#0A8754]]="!yesButtonDisabled"
          [class.hover:to-[#12C16F]]="!yesButtonDisabled"
          [disabled]="yesButtonDisabled"
          (click)="onConfirm(true)"
        >
          {{ yesButtonText }}
        </button>
      </div>
    </div>
  </div>
  <button
    (click)="onClose()"
    class="absolute right-144 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white shadow flex items-center justify-center border border-gray-200 hover:bg-green-50 z-50"
    aria-label="Close"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 text-gray-500"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 5l7 7-7 7"
      />
    </svg>
  </button>
</div>

<!-- Tailwind rotate-180 utility for icon rotation -->
<style>
  .rotate-180 {
    transform: rotate(180deg);
  }
</style>
