<header
  class="sticky top-0 flex w-full border-gray-200 bg-white border-b px-6 py-4 z-40"
>
  <div class="flex grow items-center justify-between">
    <!-- Page Title -->
    <div class="flex items-center gap-4">
      <!-- Sidebar Toggle Button -->
      <button
        (click)="toggleSidebar()"
        class="flex h-10 w-10 items-center justify-center rounded-lg text-gray-600 hover:bg-gray-100 transition-colors cursor-pointer"
        aria-label="Toggle sidebar"
      >
        <svg
          class="fill-current"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5ZM3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10ZM4 14C3.44772 14 3 14.4477 3 15C3 15.5523 3.44772 16 4 16H16C16.5523 16 17 15.5523 17 15C17 14.4477 16.5523 14 16 14H4Z"
            fill=""
          />
        </svg>
      </button>

      <h1 class="text-2xl font-bold text-black">{{ pageTitle }}</h1>
    </div>

    <!-- Search Bar -->
    <div class="flex-1 max-w-md mx-8">
      <form>
        <div class="relative">
          <span class="absolute top-1/2 left-4 -translate-y-1/2">
            <svg
              class="fill-gray-500"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M9.37508 3.04199C12.8731 3.04199 15.7084 5.87693 15.7084 9.37363C15.7084 12.8703 12.8731 15.7053 9.37508 15.7053C5.87711 15.7053 3.04175 12.8703 3.04175 9.37363C3.04175 5.87693 5.87711 3.04199 9.37508 3.04199ZM9.37508 1.54199C13.7011 1.54199 17.2084 5.04817 17.2084 9.37363C17.2084 11.2669 16.5365 13.0033 15.418 14.3573L18.2377 17.1774C18.5306 17.4703 18.5306 17.9451 18.2377 18.238C17.9448 18.5309 17.4699 18.5309 17.177 18.238L14.357 15.4176C13.003 16.5344 11.2674 17.2053 9.37508 17.2053C5.04902 17.2053 1.54175 13.6991 1.54175 9.37363C1.54175 5.04817 5.04902 1.54199 9.37508 1.54199Z"
                fill=""
              />
            </svg>
          </span>
          <input
            type="text"
            placeholder="Search"
            class="h-10 w-full rounded-lg border border-gray-300 bg-white py-2 pr-4 pl-12 text-sm text-gray-800 placeholder:text-gray-500 focus:border-gray-400 focus:outline-none"
          />
        </div>
      </form>
    </div>

    <!-- Right Side Icons -->
    <div class="flex items-center gap-4">
      <!-- Notification Icon -->
      <div class="relative">
        <button
          class="relative flex h-10 w-10 items-center justify-center rounded-full text-gray-600 hover:bg-gray-100 transition-colors cursor-pointer"
          (click)="navigateToInbox()"
        >
          <span
            [ngClass]="{ hidden: !messages, flex: messages }"
            class="absolute top-0.5 right-0 z-1 h-2 w-2 rounded-full bg-[#12C16F]"
          >
            <span
              class="absolute -z-1 inline-flex h-full w-full animate-ping rounded-full bg-[#12C16F] opacity-75"
            ></span>
          </span>
          <svg
            class="fill-current"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M16.25 3.125H3.75C3.40482 3.125 3.125 3.40482 3.125 3.75V16.25C3.125 16.5952 3.40482 16.875 3.75 16.875H16.25C16.5952 16.875 16.875 16.5952 16.875 16.25V3.75C16.875 3.40482 16.5952 3.125 16.25 3.125ZM3.75 1.875C2.71447 1.875 1.875 2.71447 1.875 3.75V16.25C1.875 17.2855 2.71447 18.125 3.75 18.125H16.25C17.2855 18.125 18.125 17.2855 18.125 16.25V3.75C18.125 2.71447 17.2855 1.875 16.25 1.875H3.75ZM4.375 8.125C4.375 7.77982 4.65482 7.5 5 7.5H15C15.3452 7.5 15.625 7.77982 15.625 8.125C15.625 8.47018 15.3452 8.75 15 8.75H5C4.65482 8.75 4.375 8.47018 4.375 8.125ZM5 11.25C4.65482 11.25 4.375 11.5298 4.375 11.875C4.375 12.2202 4.65482 12.5 5 12.5H15C15.3452 12.5 15.625 12.2202 15.625 11.875C15.625 11.5298 15.3452 11.25 15 11.25H5Z"
              fill=""
            />
          </svg>
        </button>
      </div>

      <!-- Bell Notification -->
      <div class="relative">
        <button
          class="relative flex h-10 w-10 items-center justify-center rounded-full text-gray-600 hover:bg-gray-100 transition-colors cursor-pointer"
          (click)="toggleNotificationDropdown()"
        >
          <span
            [ngClass]="{ hidden: !notifying, flex: notifying }"
            class="absolute top-0.5 right-0 z-1 h-2 w-2 rounded-full bg-[#12C16F]"
          >
            <span
              class="absolute -z-1 inline-flex h-full w-full animate-ping rounded-full bg-[#12C16F] opacity-75"
            ></span>
          </span>
          <svg
            class="fill-current"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M10.75 2.29248C10.75 1.87827 10.4143 1.54248 10 1.54248C9.58583 1.54248 9.25004 1.87827 9.25004 2.29248V2.83613C6.08266 3.20733 3.62504 5.9004 3.62504 9.16748V14.4591H3.33337C2.91916 14.4591 2.58337 14.7949 2.58337 15.2091C2.58337 15.6234 2.91916 15.9591 3.33337 15.9591H4.37504H15.625H16.6667C17.0809 15.9591 17.4167 15.6234 17.4167 15.2091C17.4167 14.7949 17.0809 14.4591 16.6667 14.4591H16.375V9.16748C16.375 5.9004 13.9174 3.20733 10.75 2.83613V2.29248Z"
              fill=""
            />
          </svg>
        </button>

        <!-- Notification Dropdown -->
        <div
          *ngIf="showNotificationDropdown"
          class="fixed bg-white rounded-lg shadow-xl border border-gray-200 w-lg"
          style="z-index: 9999; top: 60px; right: 20px"
          appClickOutside
          (clickOutside)="closeNotificationDropdown()"
        >
          <!-- Header -->
          <div
            class="flex items-center justify-between px-6 py-4 border-b border-gray-200"
          >
            <div class="flex items-center gap-2">
              <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
              <span
                class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full"
                *ngIf="getUnreadNotificationsCount() > 0"
              >
                {{ getUnreadNotificationsCount() }}
              </span>
            </div>
          </div>

          <!-- Today Section -->
          <div class="px-6 py-4">
            <h4 class="text-sm font-medium text-gray-500 mb-4">TODAY</h4>

            <!-- Notification Items -->
            <div class="space-y-3 max-h-80 overflow-y-auto">
              <div
                *ngFor="
                  let notification of getRecentNotifications();
                  let i = index
                "
                class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer"
                (click)="markNotificationAsRead(notification.id)"
              >
                <div class="flex items-start gap-4">
                  <!-- Unread Indicator -->
                  <div
                    class="w-2 h-2 rounded-full mt-2 flex-shrink-0"
                    [class.bg-green-500]="!notification.isRead"
                    [class.bg-transparent]="notification.isRead"
                  ></div>

                  <!-- Profile Image -->
                  <img
                    [src]="notification.worker.image"
                    [alt]="notification.worker.name"
                    class="w-12 h-12 rounded-full flex-shrink-0"
                  />

                  <!-- Content -->
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                      <span class="font-semibold text-gray-900 text-sm">
                        {{ notification.type }}
                      </span>
                      <span class="text-xs text-gray-500">
                        {{ notification.timestamp }}
                      </span>
                    </div>
                    <div class="text-sm text-gray-600 mt-1">
                      <span class="font-medium">{{
                        notification.worker.name
                      }}</span>
                      <span>
                        <ng-container *ngIf="shouldShowTruncated(notification)">
                          {{ getTruncatedMessage(notification) }}
                          <button
                            (click)="
                              toggleNotificationExpansion(notification.id);
                              $event.stopPropagation()
                            "
                            class="text-green-600 hover:text-green-700 font-medium ml-1"
                          >
                            View more
                          </button>
                        </ng-container>
                        <ng-container
                          *ngIf="!shouldShowTruncated(notification)"
                        >
                          {{ getFullMessage(notification) }}
                          <button
                            *ngIf="isNotificationExpanded(notification.id)"
                            (click)="
                              toggleNotificationExpansion(notification.id);
                              $event.stopPropagation()
                            "
                            class="text-green-600 hover:text-green-700 font-medium ml-1"
                          >
                            View less
                          </button>
                        </ng-container>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- View All Button -->
            <div class="mt-4 pt-4 border-t border-gray-200">
              <button
                (click)="navigateToNotifications()"
                class="w-full text-center text-green-600 hover:text-green-700 font-medium text-sm py-2 hover:bg-green-50 rounded-lg transition-colors"
              >
                View All
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- User Profile -->
      <div class="relative">
        <a
          routerLink="/profile"
          class="flex items-center gap-3 hover:cursor-pointer hover:opacity-80 transition-opacity"
        >
          <span class="h-10 w-10 overflow-hidden rounded-full">
            <img
              src="./assets/svg/profilePix.svg"
              alt="User"
              class="w-full h-full object-cover"
            />
          </span>
          <div class="flex flex-col">
            <span class="text-black font-bold text-sm">{{ userName }}</span>
            <span class="text-gray-500 text-xs">{{ role }}</span>
          </div>
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Logout Confirmation Modal -->
<app-confirm-prompt
  *ngIf="showLogoutConfirm"
  title="Confirm Logout"
  text="Are you sure you want to logout? You will be redirected to the login page."
  yesButtonText="Yes, Logout"
  noButtonText="Cancel"
  (confirmed)="onLogoutConfirmed()"
  (closed)="onLogoutCancelled()"
></app-confirm-prompt>
