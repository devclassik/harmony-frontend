<div class="flex flex-col bg-[#fcfcfc] border border-[#f2f2f2] rounded-xl p-4">
  <div
    class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between mb-4"
  >
    <h2 class="text-lg font-medium">Employee Records</h2>
    <div class="flex gap-2 items-center w-full md:w-auto">
      <div *ngIf="showSearch" class="relative w-full md:w-64">
        <input
          type="text"
          [placeholder]="searchPlaceholder"
          [ngModel]="searchValue"
          (ngModelChange)="onSearchChange($event)"
          class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-100 text-sm bg-white"
        />
        <svg
          class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
      </div>
      <button
        *ngIf="showFilter"
        class="flex items-center gap-1 px-3 py-2 border border-gray-200 rounded-lg bg-white text-sm text-gray-700 hover:bg-gray-50"
      >
        <svg
          class="h-4 w-4"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707l-6.414 6.414A1 1 0 0013 13.414V19a1 1 0 01-1.447.894l-2-1A1 1 0 019 18v-4.586a1 1 0 00-.293-.707L2.293 6.707A1 1 0 012 6V4z"
          />
        </svg>
        Filter
      </button>
      <a *ngIf="showViewAll" [href]="viewAllLink" class="text-green-500 font-medium hover:underline text-sm">{{ viewAllText }}</a>

    </div>
  </div>

  <div class="flex flex-wrap gap-2 mb-2">   
    <ng-container *ngFor="let tab of filterTabs">
      <button
        (click)="onTabChange(tab)"
        [ngClass]="{
          'bg-green-100 text-green-700': activeTab === tab.value,
          'bg-gray-100 text-gray-600': activeTab !== tab.value
        }"
        class="px-4 py-1 rounded-lg text-sm font-medium transition-colors"
      >
        {{ tab.label }}
      </button>
    </ng-container>
  </div>

  <table class="w-full border-separate border-spacing-0 my-4">
    <thead>
      <tr>
        <th
          *ngFor="let col of columns"
          class="p-4 text-left bg-gray-50 text-[#7a7a7a] font-medium"
          [ngClass]="col.class"
        >
          {{ col.label }}
        </th>
      </tr> 
    </thead>
    <tbody>
      <tr
        *ngFor="let employee of employees; let i = index"
        class="hover:bg-gray-50"
      >
        <td *ngFor="let col of columns" class="p-4">
          <!-- EMPLOYEE ID -->
          <ng-container *ngIf="col.key === 'id'">{{
            employee.id
          }}</ng-container>

          <!-- EMPLOYEE NAME -->
          <ng-container *ngIf="col.key === 'name'">
            <div class="flex items-center">
              <img
                [src]="employee.imageUrl"
                [alt]="employee.name"
                class="w-8 h-8 rounded-full mr-2"
              />
              {{ employee.name }}
            </div>
          </ng-container>

          <!-- DEPARTMENT -->
          <ng-container *ngIf="col.key === 'department'">{{
            employee["department"] ? employee["department"] : "-"
          }}</ng-container>

          <!-- ROLE -->
          <ng-container *ngIf="col.key === 'role'">{{
            employee.role
          }}</ng-container>

          <!-- STATUS -->
          <ng-container *ngIf="col.key === 'status'">
            <span
              [ngClass]="{
                'flex items-center gap-2 px-3 py-1 rounded-full text-sm w-fit': true,
                'bg-[#DDFFE0] text-[#049914]': employee.status === 'Active',
                'bg-[#FEF9EA] text-[#E0A800]': employee.status === 'On leave',
                'bg-[#E8FAFF] text-[#008FBD]': employee.status === 'Retired',
                'bg-[#FFDEDE] text-[#DD1212]':
                  employee.status === 'On Discipline'
              }"
            >
              <span
                class="h-2 w-2 rounded-full"
                [ngClass]="{
                  'bg-[#049914]': employee.status === 'Active',
                  'bg-[#E0A800]': employee.status === 'On leave',
                  'bg-[#008FBD]': employee.status === 'Retired',
                  'bg-[#DD1212]': employee.status === 'On Discipline'
                }"
              ></span>
              {{ employee.status }}
            </span>
          </ng-container>

          <!-- ACTION -->
          <ng-container *ngIf="col.key === 'action'">
            <div class="relative">
              <button
                (click)="toggleDropdown(employee, i)"
                class="p-2 rounded-full cursor-pointer hover:bg-gray-100"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 text-gray-500"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"
                  />
                </svg>
              </button>
              <div
                *ngIf="activeDropdownKey === getDropdownKey(employee, i)"
                class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border border-gray-100"
              >
                <div class="py-1">
                  <button
                    *ngFor="let item of menuItems"
                    (click)="handleAction(item.action, employee)"
                    class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"
                  >
                    <svg
                      *ngIf="item.action !== 'delete'"
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <circle
                        *ngIf="item.action === 'view'"
                        cx="12"
                        cy="12"
                        r="6"
                        stroke-width="2"
                      />
                      <circle
                        *ngIf="item.action === 'approve'"
                        cx="12"
                        cy="12"
                        r="6"
                        stroke-width="2"
                      />
                      <path
                        *ngIf="item.action === 'approve'"
                        d="M9 12l2 2 4-4"
                        stroke-width="2"
                      />
                    </svg>
                    <svg
                      *ngIf="item.action === 'delete'"
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      />
                    </svg>
                    {{ item.label }}
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>

  <div
    class="flex flex-col md:flex-row md:items-center md:justify-end gap-2"
  >
    <div
      *ngIf="showPagination"
      class="flex items-center gap-2 justify-center md:justify-end"
    >
      <button
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="px-2 py-1 rounded border border-gray-200 bg-white text-gray-500 disabled:opacity-50"
      >
        &laquo;
      </button>
      <ng-container
        *ngFor="let page of [].constructor(totalPages); let p = index"
      >
        <button
          (click)="onPageChange(p + 1)"
          [ngClass]="{
            'bg-green-500 text-white': currentPage === p + 1,
            'bg-white text-gray-700': currentPage !== p + 1
          }"
          class="px-2 py-1 rounded border border-gray-200"
        >
          {{ p + 1 }}
        </button>
      </ng-container>
      <button
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 rounded border border-gray-200 bg-white text-gray-500 disabled:opacity-50"
      >
        &raquo;
      </button>
    </div>
  </div>
</div>
