<div class="flex flex-col bg-[#fcfcfc] border border-[#f2f2f2] rounded-xl p-4">
  <div
    class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between mb-4"
  >
    <h2 class="text-lg font-medium">{{ tableTitle }}</h2>
    <div class="flex gap-2 items-center w-full md:w-auto">
      <div *ngIf="showSearch" class="relative w-full md:w-64">
        <input
          type="text"
          [placeholder]="searchPlaceholder"
          [ngModel]="searchValue"
          (ngModelChange)="onSearchChange($event)"
          [ngClass]="{
            'ring-2 ring-green-200 bg-green-50': searchValue,
            'bg-white': !searchValue
          }"
          class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none text-sm"
        />
        <svg
          class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
      </div>
      <div class="relative" *ngIf="showFilter">
        <button
          (click)="toggleFilterDropdown()"
          class="flex items-center gap-1 px-3 py-2 border border-gray-200 rounded-lg bg-white text-sm text-gray-700 hover:bg-gray-50"
          [ngClass]="{
            'bg-green-100 text-green-700': activeFilterTab !== '',
            'bg-white text-gray-600 hover:bg-gray-100': activeFilterTab === ''
          }"
          type="button"
        >
          <svg
            class="h-4 w-4"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707l-6.414 6.414A1 1 0 0013 13.414V19a1 1 0 01-1.447.894l-2-1A1 1 0 019 18v-4.586a1 1 0 00-.293-.707L2.293 6.707A1 1 0 012 6V4z"
            />
          </svg>
          Filter
        </button>
        <div
          *ngIf="showFilterDropdown"
          class="absolute left-0 mt-2 bg-white rounded-md shadow-lg z-10 border border-gray-100"
        >
          <div class="py-1">
            <button
              *ngFor="let tab of filterTabs"
              (click)="onFilterTabClick(tab)"
              [ngClass]="{
                'bg-green-100 text-green-700':
                  activeFilterTab === tab.value && tab.value !== '',
                'bg-white text-gray-600 hover:bg-gray-100':
                  activeFilterTab !== tab.value || tab.value === ''
              }"
              class="flex items-center gap-2 px-4 py-2 text-sm w-full text-left"
            >
              <ng-container *ngIf="tab.icon">
                <svg
                  *ngIf="tab.icon.startsWith('M')"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path [attr.d]="tab.icon" />
                </svg>
                <i *ngIf="!tab.icon.startsWith('M')" [class]="tab.icon"></i>
              </ng-container>
              {{ tab.label }}
            </button>
          </div>
        </div>
      </div>
      <div class="flex gap-4" *ngIf="showButton">
        <button
          class="flex items-center justify-center px-2 flex-1 bg-green-600 text-white rounded-lg py-2 font-medium transition hover:bg-green-700 cursor-pointer"
          (click)="onButtonClick(true)"
        >
          <span class="flex items-center px-1">
            <img [src]="showButtonIcon" class="w-4 h-4 text-white" />
          </span>
          {{ showButtonText }}
        </button>
      </div>
      <div class="flex gap-4" *ngIf="showList">
        <button
          class="flex items-center justify-center px-2 flex-1 rounded-lg py-2 font-medium transition cursor-pointer"
          [ngClass]="{
            'bg-[#12C16F] text-white': activeView === 'list',
            'bg-[#dddddd] text-[#12C16F]': activeView !== 'list'
          }"
          (click)="toggleListCalendar('list')"
        >
          <span class="flex items-center px-1">
            <img [src]="showListIcon" class="w-4 h-4 text-white" />
          </span>
        </button>
      </div>
      <div class="flex gap-4" *ngIf="showCalendar">
        <button
          class="flex items-center justify-center px-2 flex-1 rounded-lg py-2 font-medium transition cursor-pointer"
          [ngClass]="{
            'bg-[#12C16F] text-white': activeView === 'calendar',
            'bg-[#dddddd] text-[#12C16F]': activeView !== 'calendar'
          }"
          (click)="toggleListCalendar('calendar')"
        >
          <span class="flex items-center px-1">
            <img [src]="showCalendarIcon" class="w-4 h-4 text-white" />
          </span>
        </button>
      </div>

      <a
        *ngIf="showViewAll"
        [href]="viewAllLink"
        class="text-green-500 font-medium hover:underline text-sm"
        >{{ viewAllText }}</a
      >
    </div>
  </div>

  <div class="flex mb-4">
    <full-calendar
      *ngIf="activeView === 'calendar'"
      [options]="calendarOptions"
      class="w-full"
    >
    </full-calendar>
  </div>

  <div class="flex flex-wrap gap-2 mb-2" *ngIf="showStatusTab">
    <ng-container *ngFor="let tab of statusTabs">
      <button
        (click)="onStatusTabClick(tab)"
        [ngClass]="{
          'bg-green-100 text-green-700':
            activeStatusTab === tab.value && tab.value !== '',
          'bg-white text-gray-600 hover:bg-gray-100':
            activeStatusTab !== tab.value || tab.value === ''
        }"
        class="px-4 py-1 rounded-lg text-sm font-medium transition-colors"
      >
        {{ tab.label }}
      </button>
    </ng-container>
  </div>

  <table
    class="w-full border-separate border-spacing-0 my-4 bg-[#ededed]"
    *ngIf="tableData.length > 0"
  >
    <thead>
      <tr>
        <th
          *ngIf="showSelectCheckbox"
          class="p-4 text-left !text-sm bg-[#F4F5F6] text-[#7a7a7a] font-medium"
        >
          <input
            #selectAllBox
            type="checkbox"
            [checked]="isAllSelected()"
            (change)="toggleSelectAll(selectAllBox.checked)"
            class="accent-[#049914]"
          />
        </th>
        <th
          *ngFor="let col of tableHeader"
          class="p-4 text-left !text-sm bg-[#F4F5F6] text-[#7a7a7a] font-medium"
          [ngClass]="col.class"
        >
          {{ col.label }}
        </th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let employee of tableData; let i = index"
        class="bg-white hover:bg-gray-50"
      >
        <td *ngIf="showSelectCheckbox" class="p-4 border-b border-[#ededed]">
          <input
            #rowBox
            type="checkbox"
            [checked]="isRowSelected(employee)"
            (change)="toggleRowSelection(employee, rowBox.checked)"
          />
        </td>
        <td
          *ngFor="let col of tableHeader"
          class="p-4 border-b border-[#ededed]"
        >
          <!-- EMPLOYEE ID -->
          <ng-container *ngIf="col.key === 'id'">{{
            employee.id
          }}</ng-container>

          <!-- EMPLOYEE NAME -->
          <ng-container *ngIf="col.key === 'name'">
            <div class="flex items-center">
              <img
                [src]="employee.imageUrl"
                [alt]="employee.name"
                class="w-8 h-8 rounded-full mr-2"
              />
              {{ employee.name }}
            </div>
          </ng-container>

          <!-- DISCIPLINE TYPE -->
          <ng-container *ngIf="col.key === 'disciplineType'">{{
            employee["disciplineType"] ? employee["disciplineType"] : "-"
          }}</ng-container>

          <!-- OFFENSE CATEGORY -->
          <ng-container *ngIf="col.key === 'offenseCategory'">{{
            employee["offenseCategory"] ? employee["offenseCategory"] : "-"
          }}</ng-container>

          <!-- DURATION OF DISCIPLINE -->
          <ng-container *ngIf="col.key === 'disciplineDuration'">{{
            employee["disciplineDuration"]
              ? employee["disciplineDuration"]
              : "-"
          }}</ng-container>

          <!-- DEPARTMENT -->
          <ng-container *ngIf="col.key === 'department'">{{
            employee["department"] ? employee["department"] : "-"
          }}</ng-container>

          <!-- ROLE -->
          <ng-container *ngIf="col.key === 'role'">{{
            employee.role
          }}</ng-container>

          <!-- RETRENCHMENT TYPE -->
          <ng-container *ngIf="col.key === 'retrenchmentType'">{{
            employee.retrenchmentType
          }}</ng-container>

          <!-- TRANSFER TYPE -->
          <ng-container *ngIf="col.key === 'transferType'">{{
            employee.transferType
          }}</ng-container>

          <!-- REQUEST DATE -->
          <ng-container *ngIf="col.key === 'requestDate'">{{
            employee.requestDate
          }}</ng-container>

          <!-- DESTINATION -->
          <ng-container *ngIf="col.key === 'destination'">{{
            employee.destination
          }}</ng-container>

          <!-- START DATE -->
          <ng-container *ngIf="col.key === 'startDate'">{{
            employee.startDate
          }}</ng-container>

          <!-- END DATE -->
          <ng-container *ngIf="col.key === 'endDate'">{{
            employee.endDate
          }}</ng-container>

          <!-- STATUS -->
          <ng-container *ngIf="col.key === 'status'">
            <span
              [ngClass]="{
                'flex items-center gap-2 px-3 py-1 rounded-full text-sm w-fit': true,
                'bg-[#DDFFE0] text-[#049914]':
                  employee.status === 'Active' ||
                  employee.status === 'Approved',
                'bg-[#FEF9EA] text-[#E0A800]':
                  employee.status === 'On leave' ||
                  employee.status === 'Pending',
                'bg-[#E8FAFF] text-[#008FBD]': employee.status === 'Retired',
                'bg-[#FFDEDE] text-[#DD1212]':
                  employee.status === 'On Discipline' ||
                  employee.status === 'Rejected'
              }"
            >
              <span
                class="h-2 w-2 rounded-full"
                [ngClass]="{
                  'bg-[#049914]':
                    employee.status === 'Active' ||
                    employee.status === 'Approved',
                  'bg-[#E0A800]':
                    employee.status === 'On leave' ||
                    employee.status === 'Pending',
                  'bg-[#008FBD]': employee.status === 'Retired',
                  'bg-[#DD1212]':
                    employee.status === 'On Discipline' ||
                    employee.status === 'Rejected'
                }"
              ></span>
              {{ employee.status }}
            </span>
          </ng-container>

          <!-- ACTION -->
          <ng-container *ngIf="col.key === 'action'">
            <div class="relative">
              <button
                (click)="toggleDropdown(employee, i)"
                class="p-2 rounded-full cursor-pointer hover:bg-gray-100"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 text-gray-500"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"
                  />
                </svg>
              </button>
              <div
                *ngIf="activeDropdownKey === getDropdownKey(employee, i)"
                class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border border-gray-100"
              >
                <div class="py-1">
                  <button
                    *ngFor="let item of menuItems"
                    (click)="handleAction(item.action, employee)"
                    class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left hover:rounded-md"
                    [ngClass]="{
                      'hover:bg-red-500 ': item.action === 'Delete',
                    }"
                  >
                    <svg
                      *ngIf="item.action !== 'delete'"
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <circle
                        *ngIf="item.action === 'view'"
                        cx="12"
                        cy="12"
                        r="6"
                        stroke-width="2"
                      />
                      <circle
                        *ngIf="item.action === 'approve'"
                        cx="12"
                        cy="12"
                        r="6"
                        stroke-width="2"
                      />
                      <path
                        *ngIf="item.action === 'approve'"
                        d="M9 12l2 2 4-4"
                        stroke-width="2"
                      />
                    </svg>
                    <svg
                      *ngIf="item.action === 'delete'"
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      />
                    </svg>
                    {{ item.label }}
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
        </td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="!tableData.length" class="py-8 text-center text-gray-400">
    <ng-container *ngIf="emptyStateTemplate; else defaultEmpty">
      <ng-container *ngTemplateOutlet="emptyStateTemplate"></ng-container>
    </ng-container>
    <ng-template #defaultEmpty>
      <img
        [src]="emptyStateImage"
        alt="Empty State"
        class="w-16 h-16 mx-auto mb-4"
      />
      {{ emptyStateText }}
    </ng-template>
  </div>

  <div class="flex flex-col md:flex-row md:items-center md:justify-end gap-2">
    <div
      *ngIf="showPagination"
      class="flex items-center gap-2 justify-center md:justify-end"
    >
      <button
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1"
        class="px-2 py-1 rounded border border-gray-200 bg-white text-gray-500 disabled:opacity-50"
      >
        &laquo;
      </button>
      <ng-container
        *ngFor="let page of [].constructor(totalPages); let p = index"
      >
        <button
          (click)="onPageChange(p + 1)"
          [ngClass]="{
            'bg-green-500 text-white': currentPage === p + 1,
            'bg-white text-gray-700': currentPage !== p + 1
          }"
          class="px-2 py-1 rounded border border-gray-200"
        >
          {{ p + 1 }}
        </button>
      </ng-container>
      <button
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages"
        class="px-2 py-1 rounded border border-gray-200 bg-white text-gray-500 disabled:opacity-50"
      >
        &raquo;
      </button>
    </div>
  </div>
</div>
