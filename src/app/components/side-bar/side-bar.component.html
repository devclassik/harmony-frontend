<aside
  [ngClass]="sidebarToggle ? 'translate-x-0 lg:w-[80px]' : '-translate-x-full'"
  class="sidebar fixed left-0 top-0 z-9999 flex h-screen w-[290px] flex-col overflow-y-hidden border-r border-gray-200 bg-[#FCFCFC] duration-300 ease-linear dark:border-gray-100 dark:bg-[#FCFCFC] lg:static lg:translate-x-0"
  [class.px-5]="!sidebarToggle"
  [class.px-2]="sidebarToggle"
>
  <!-- SIDEBAR HEADER -->
  <div
    [ngClass]="sidebarToggle ? 'justify-center' : 'justify-between'"
    class="sidebar-header flex items-center gap-2 pb-7 pt-8 hover:cursor-pointer"
  >
    <a routerLink="/">
      <span class="logo" [ngClass]="sidebarToggle ? 'hidden' : ''">
        <img
          class="dark:hidden"
          src="/assets/images/harmonyLogo.png"
          alt="Logo"
        />
        <img
          class="hidden dark:block"
          src="/assets/images/harmonyLogo.png"
          alt="Logo"
        />
      </span>

      <img
        class="logo-icon hover:cursor-pointer object-contain"
        [ngClass]="sidebarToggle ? 'lg:block h-14 w-14 p-1' : 'hidden'"
        src="/assets/images/harmonyLogo.png"
        alt="Logo"
      />
    </a>
  </div>
  <!-- SIDEBAR HEADER -->

  <!-- Main Menu Section -->
  <div
    class="no-scrollbar flex flex-col flex-1 overflow-y-auto duration-300 ease-linear"
  >
    <!-- Sidebar Menu -->
    <nav class="flex-1">
      <ul class="mb-6 flex flex-col gap-2">
        <!-- Dashboard -->
        <li class="menu-item">
          <a
            routerLink="/dashboard"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Dashboard' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >dashboard</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Dashboard</span
            >
          </a>
        </li>

        <!-- Employee Record -->
        <li class="menu-item" *ngIf="canViewEmployeeRecords()">
          <a
            routerLink="/employee-records"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Employee Record' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >assignment</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Employee Record</span
            >
          </a>
        </li>

        <!-- Reporting & Analytics -->
        <li class="menu-item" *ngIf="canViewReportingAnalytics()">
          <a
            routerLink="/reporting-and-analytics"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Reporting & Analytics' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >poll</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Reporting & Analytics</span
            >
          </a>
        </li>

        <!-- Employee Management -->
        <li class="menu-item" *ngIf="canViewEmployeeManagement()">
          <div *ngIf="!sidebarToggle" class="flex flex-col">
            <button
              (click)="toggleEmployeeMenu()"
              class="flex items-center justify-between gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer transition-all duration-200"
              [ngClass]="{
                'bg-[#12C16F] text-white': isEmployeeChildActive(),
                'text-gray-400': !isEmployeeChildActive()
              }"
            >
              <div class="flex items-center gap-3">
                <mat-icon
                  class="text-lg"
                  [ngClass]="{
                    'text-white': isEmployeeChildActive(),
                    'text-gray-400': !isEmployeeChildActive()
                  }"
                  >people</mat-icon
                >
                <span class="font-medium">Employee Management</span>
              </div>
              <mat-icon
                class="text-lg"
                [ngClass]="{
                  'text-white': isEmployeeChildActive(),
                  'text-gray-400': !isEmployeeChildActive()
                }"
                >{{
                  employeeManagement ? "expand_less" : "expand_more"
                }}</mat-icon
              >
            </button>

            <div
              *ngIf="employeeManagement"
              class="mt-2 ml-4 flex flex-col gap-2 px-4 list-none"
            >
              <a
                routerLink="employee-management/promotion"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': promotionLink.isActive,
                  'text-gray-400': !promotionLink.isActive
                }"
                #promotionLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    promotionLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Promotion</a
              >
              <a
                routerLink="employee-management/discipline"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': disciplineLink.isActive,
                  'text-gray-400': !disciplineLink.isActive
                }"
                #disciplineLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    disciplineLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Discipline</a
              >
              <a
                routerLink="employee-management/transfer"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': transferLink.isActive,
                  'text-gray-400': !transferLink.isActive
                }"
                #transferLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    transferLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Transfer</a
              >
              <a
                routerLink="employee-management/retirement"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': retirementLink.isActive,
                  'text-gray-400': !retirementLink.isActive
                }"
                #retirementLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    retirementLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Retirement</a
              >
              <a
                routerLink="employee-management/retrenchment"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': retrenchmentLink.isActive,
                  'text-gray-400': !retrenchmentLink.isActive
                }"
                #retrenchmentLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    retrenchmentLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Retrenchment</a
              >
            </div>
          </div>

          <!-- Collapsed state - just show icon with tooltip -->
          <div
            *ngIf="sidebarToggle"
            class="flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200"
            [ngClass]="{
              'bg-[#12C16F] text-white': isEmployeeChildActive(),
              'text-gray-400': !isEmployeeChildActive()
            }"
            [matTooltip]="'Employee Management'"
            [matTooltipPosition]="'right'"
            (click)="toggleEmployeeMenu()"
          >
            <mat-icon class="text-xl">people</mat-icon>
          </div>
        </li>

        <!-- Leave Management -->
        <li class="menu-item" *ngIf="canViewLeaveManagement()">
          <div *ngIf="!sidebarToggle" class="flex flex-col">
            <button
              (click)="toggleLeaveMenu()"
              class="flex items-center justify-between gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer transition-all duration-200"
              [ngClass]="{
                'bg-[#12C16F] text-white': isEmployeeLeaveChildActive(),
                'text-gray-400': !isEmployeeLeaveChildActive()
              }"
            >
              <div class="flex items-center gap-3">
                <mat-icon
                  class="text-lg"
                  [ngClass]="{
                    'text-white': isEmployeeLeaveChildActive(),
                    'text-gray-400': !isEmployeeLeaveChildActive()
                  }"
                  >event_note</mat-icon
                >
                <span class="font-medium">Leave Management</span>
              </div>
              <mat-icon
                class="text-lg"
                [ngClass]="{
                  'text-white': isEmployeeLeaveChildActive(),
                  'text-gray-400': !isEmployeeLeaveChildActive()
                }"
                >{{ leaveManagement ? "expand_less" : "expand_more" }}</mat-icon
              >
            </button>

            <div
              *ngIf="leaveManagement"
              class="mt-2 ml-4 flex flex-col gap-2 px-4 list-none"
            >
              <a
                routerLink="leave-management/annual-leave"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': annualLeaveLink.isActive,
                  'text-gray-400': !annualLeaveLink.isActive
                }"
                #annualLeaveLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    annualLeaveLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Annual Leave</a
              >
              <a
                routerLink="leave-management/leave-of-absence"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': leaveOfAbsenceLink.isActive,
                  'text-gray-400': !leaveOfAbsenceLink.isActive
                }"
                #leaveOfAbsenceLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    leaveOfAbsenceLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Leave of Absence</a
              >
              <a
                routerLink="leave-management/sick-leave"
                routerLinkActive="router-active"
                [routerLinkActiveOptions]="{ exact: true }"
                class="py-2 px-3 hover:text-[#12C16F] rounded-lg transition-colors duration-200"
                [ngClass]="{
                  'text-[#12C16F]': sickLeaveLink.isActive,
                  'text-gray-400': !sickLeaveLink.isActive
                }"
                #sickLeaveLink="routerLinkActive"
                ><span
                  class="inline-block w-2 h-2 rounded-full mr-3"
                  [ngClass]="
                    sickLeaveLink.isActive ? 'bg-[#12C16F]' : 'bg-gray-400'
                  "
                ></span
                >Sick Leave</a
              >
            </div>
          </div>

          <!-- Collapsed state - just show icon with tooltip -->
          <div
            *ngIf="sidebarToggle"
            class="flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200"
            [ngClass]="{
              'bg-[#12C16F] text-white': isEmployeeLeaveChildActive(),
              'text-gray-400': !isEmployeeLeaveChildActive()
            }"
            [matTooltip]="'Leave Management'"
            [matTooltipPosition]="'right'"
            (click)="toggleLeaveMenu()"
          >
            <mat-icon class="text-xl">event_note</mat-icon>
          </div>
        </li>

        <!-- File Index -->
        <li class="menu-item" *ngIf="canViewFileIndex()">
          <a
            routerLink="/file-index"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'File Index' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >insert_drive_file</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >File Index</span
            >
          </a>
        </li>

        <!-- Camp Meeting -->
        <li class="menu-item" *ngIf="canViewCampMeeting()">
          <a
            routerLink="/camp-meeting"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Camp Meeting' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >event</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Camp Meeting</span
            >
          </a>
        </li>

        <!-- Calendar -->
        <li class="menu-item" *ngIf="canViewCalendar()">
          <a
            routerLink="/calendar"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Calendar' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >calendar_today</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Calendar</span
            >
          </a>
        </li>

        <!-- Payroll -->
        <li class="menu-item" *ngIf="canViewPayroll()">
          <a
            routerLink="/payroll"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Payroll' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >account_balance_wallet</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Payroll</span
            >
          </a>
        </li>

        <!-- Settings -->
        <li class="menu-item" *ngIf="canViewSettings()">
          <a
            routerLink="/settings"
            routerLinkActive="bg-[#12C16F] text-white"
            [routerLinkActiveOptions]="{ exact: true }"
            [matTooltip]="sidebarToggle ? 'Settings' : ''"
            [matTooltipPosition]="'right'"
            [class]="
              sidebarToggle
                ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
                : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-[#12C16F] hover:text-white cursor-pointer text-gray-400 transition-all duration-200'
            "
          >
            <mat-icon [class]="sidebarToggle ? 'text-xl' : 'text-lg'"
              >settings</mat-icon
            >
            <span
              [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
              class="font-medium"
              >Settings</span
            >
          </a>
        </li>
      </ul>
    </nav>
    <!-- Sidebar Menu -->
  </div>

  <!-- Footer Section with Logout -->
  <div class="border-t border-gray-200 pt-4 pb-4">
    <button
      (click)="logout()"
      [matTooltip]="sidebarToggle ? 'Logout' : ''"
      [matTooltipPosition]="'right'"
      [class]="
        sidebarToggle
          ? 'flex items-center justify-center w-12 h-12 mx-auto rounded-lg hover:bg-red-50 hover:text-red-600 cursor-pointer transition-all duration-200'
          : 'flex items-center gap-3 py-3 px-4 rounded-lg hover:bg-red-50 hover:text-red-600 cursor-pointer w-full text-left transition-all duration-200'
      "
    >
      <mat-icon
        [class]="
          sidebarToggle ? 'text-xl text-red-500' : 'text-lg text-red-500'
        "
        >logout</mat-icon
      >
      <span
        [ngClass]="sidebarToggle ? 'lg:hidden' : ''"
        class="text-red-600 font-medium"
        >Logout</span
      >
    </button>
  </div>
</aside>

<!-- Logout Confirmation Modal -->
<app-confirm-prompt
  *ngIf="showLogoutConfirm"
  title="Confirm Logout"
  text="Are you sure you want to logout? You will be redirected to the login page."
  yesButtonText="Yes, Logout"
  noButtonText="Cancel"
  (confirmed)="onLogoutConfirmed()"
  (closed)="onLogoutCancelled()"
></app-confirm-prompt>
